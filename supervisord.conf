[supervisord]
user=root
nodaemon=true

[program:xvfb]
command=Xvfb :99 -screen 0 %(ENV_RESOLUTION)s -ac +extension GLX +render -noreset
autorestart=true
priority=100

[program:vnc_setup]
command=bash -c "mkdir -p /root/.vnc && echo '%(ENV_VNC_PASSWORD)s' | vncpasswd -f > /root/.vnc/passwd && chmod 600 /root/.vnc/passwd"
priority=150

[program:chrome]
command=google-chrome-stable --remote-debugging-port=9222 --remote-debugging-address=0.0.0.0 --no-sandbox --disable-gpu --user-data-dir=/tmp/chrome-data
environment=DISPLAY=":99"
autorestart=true
priority=180

[program:x11vnc]
command=x11vnc -display :99 -forever -shared -rfbauth /root/.vnc/passwd -rfbport 5901
autorestart=true
priority=200
depends_on=vnc_setup,xvfb,chrome

[program:novnc]
command=/opt/novnc/utils/novnc_proxy --vnc localhost:5901 --listen 6080
autorestart=true
priority=300
depends_on=x11vnc

[program:webui]
command=python webui.py --ip 0.0.0.0 --port 7788
directory=/app
autorestart=true
environment=DISPLAY=":99"
priority=400